#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <stdint.h>
#include <sys/types.h>

#define tmpn  "/var/tmp/badb0i"
#define PAGE_SIZE 4096
#define SMALL_SIZE PAGE_SIZE/32

uint8_t key = 0x17;

static void die(const char *m);
extern void xor(char * src, uint32_t len);
extern void *zmalloc(const uint32_t sz);

void *zmalloc(const uint32_t sz) {
  void *membuf = malloc(sz);
  if (membuf == NULL) return NULL;
  memset(membuf, 0, sz);

  return membuf;
}

extern void xor(char * src, uint32_t len) {
  while (len-- > 0) {
      *src = *src ^ key;
      src++;
  }
}

static void die(const char *m) {
  if (m != NULL)
    fprintf(stderr, "%s\n", m);
  kill(getpid(), 9);
}
